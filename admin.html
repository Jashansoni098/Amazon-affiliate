<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body class="bg-light">

    <div class="container">
        <!-- Login Form Section -->
        <div id="login-section" class="row justify-content-center align-items-center" style="height: 100vh;">
            <div class="col-md-5">
                <div class="card p-4 shadow">
                    <h3 class="text-center mb-4">Admin Login</h3>
                    <form id="loginForm">
                        <div class="mb-3"><label class="form-label">Email address</label><input type="email" class="form-control" id="email" required></div>
                        <div class="mb-3"><label class="form-label">Password</label><input type="password" class="form-control" id="password" required></div>
                        <button type="submit" class="btn btn-primary w-100">Login</button>
                        <p id="loginError" class="text-danger mt-2"></p>
                    </form>
                </div>
            </div>
        </div>

        <!-- Admin Panel Section -->
        <div id="admin-panel-section" class="mt-4" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-3"><h1>Admin Panel</h1><button id="logout-button" class="btn btn-danger">Logout</button></div>
            <div class="row">
                <!-- Left Column for Products -->
                <div class="col-lg-8">
                    <div class="card p-3 my-4 shadow-sm">
                        <h2 id="product-form-title" class="mb-3">Add New Product</h2>
                        <form id="productForm"><input type="hidden" id="editProductKey"><div class="mb-3"><label class="form-label">Product Name:</label><input type="text" id="product_name" class="form-control" required></div><div class="row g-2 mb-3"><div class="col-md"><label class="form-label">M.R.P.</label><input type="number" id="product_mrp" class="form-control" required></div><div class="col-md"><label class="form-label">Selling Price</label><input type="number" id="product_price" class="form-control" required></div></div><div class="mb-3"><label class="form-label">Category:</label><select id="product_category" class="form-select" required><option value="">Select a Category</option></select></div><div class="mb-3"><label class="form-label">Description:</label><textarea id="product_description" class="form-control" rows="3" required></textarea></div><div class="mb-3"><label class="form-label">Affiliate Link:</label><input type="text" id="affiliate_link" class="form-control" placeholder="Use amzn.to/... link" required></div><div class="mb-3"><label class="form-label">Image URL:</label><input type="text" id="image_url" class="form-control" required></div><button type="submit" id="product-submit-btn" class="btn btn-primary">Add Product</button><button type="button" id="product-cancel-edit-btn" class="btn btn-secondary d-none">Cancel Edit</button></form>
                    </div>
                    <div class="card p-3 my-4 shadow-sm"><h2 class="mb-3">Manage Existing Products</h2><div class="table-responsive"><table class="table table-striped table-hover"><thead><tr><th>Product Name</th><th>Category</th><th class="text-end">Actions</th></tr></thead><tbody id="existing-products-table"></tbody></table></div></div>
                </div>

                <!-- Right Column for Categories, Banner, and Social Links -->
                <div class="col-lg-4">
                    <div class="card p-3 my-4 shadow-sm">
                        <h2 id="category-form-title" class="mb-3">Add Category</h2>
                        <form id="categoryForm" class="mb-3"><input type="hidden" id="editCategoryKey"><div class="mb-3"><label class="form-label">Category Name</label><input type="text" id="category_name" class="form-control" required></div><button type="submit" id="category-submit-btn" class="btn btn-success w-100">Add Category</button><button type="button" id="category-cancel-edit-btn" class="btn btn-secondary w-100 mt-2 d-none">Cancel Edit</button></form>
                        <hr>
                        <h5>Existing Categories:</h5>
                        <ul id="categoryList" class="list-group"></ul>
                    </div>
                    <div class="card p-3 my-4 shadow-sm">
                        <h2 class="mb-3">Manage Main Banner</h2>
                        <form id="bannerForm">
                            <div class="mb-3"><label class="form-label">Banner Image URL</label><input type="url" id="bannerImageUrl" class="form-control" placeholder="https://.../banner.jpg" required></div>
                            <div class="mb-3"><label class="form-label">Banner Affiliate Link</label><input type="url" id="bannerAffiliateLink" class="form-control" placeholder="amzn.to/..." required></div>
                            <div class="mb-3"><label class="form-label">Optional Title</label><input type="text" id="bannerTitle" class="form-control" placeholder="e.g., Diwali Dhamaka Sale!"></div>
                            <button type="submit" class="btn btn-primary w-100">Save Banner</button>
                        </form>
                    </div>
                    <div class="card p-3 my-4 shadow-sm">
                        <h2 class="mb-3">Manage Social Links</h2>
                        <form id="socialLinksForm">
                            <div class="input-group mb-3"><span class="input-group-text"><i class="bi bi-facebook"></i></span><input type="url" id="facebookLink" class="form-control" placeholder="Facebook Page URL"></div>
                            <div class="input-group mb-3"><span class="input-group-text"><i class="bi bi-instagram"></i></span><input type="url" id="instagramLink" class="form-control" placeholder="Instagram Profile URL"></div>
                            <div class="input-group mb-3"><span class="input-group-text"><i class="bi bi-telegram"></i></span><input type="url" id="telegramLink" class="form-control" placeholder="Telegram Channel URL"></div>
                            <button type="submit" class="btn btn-primary w-100">Save Social Links</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script>
        const firebaseConfig = { apiKey: "AIzaSyABu3fhCS6vqRkyKgCbTt7SS6ujtavdwCI", authDomain: "admin-panel-3b889.firebaseapp.com", databaseURL: "https://admin-panel-3b889-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "admin-panel-3b889", storageBucket: "admin-panel-3b889.appspot.com", messagingSenderId: "487073865388", appId: "1:487073865388:web:5980b372fe289c930e8909" };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        let allAdminProducts = {}, allAdminCategories = {};

        const loginSection = document.getElementById('login-section'), adminPanelSection = document.getElementById('admin-panel-section'), loginForm = document.getElementById('loginForm'), logoutButton = document.getElementById('logout-button'), loginError = document.getElementById('loginError');

        const loadSocialLinks = () => { database.ref('socialLinks').once('value').then(snapshot => { const links = snapshot.val(); if (links) { document.getElementById('facebookLink').value = links.facebook || ''; document.getElementById('instagramLink').value = links.instagram || ''; document.getElementById('telegramLink').value = links.telegram || ''; } }); };
        const loadBannerData = () => { database.ref('mainBanner').once('value').then(snapshot => { const data = snapshot.val(); if (data) { document.getElementById('bannerImageUrl').value = data.imageUrl || ''; document.getElementById('bannerAffiliateLink').value = data.affiliateLink || ''; document.getElementById('bannerTitle').value = data.title || ''; } }); };
        const loadCategories = () => { const catRef = database.ref('categories'); catRef.on('value', (snapshot) => { allAdminCategories = snapshot.val() || {}; const catList = document.getElementById('categoryList'); const prodCatSelect = document.getElementById('product_category'); catList.innerHTML = ''; prodCatSelect.innerHTML = '<option value="">Select a Category</option>'; for (const key in allAdminCategories) { const c = allAdminCategories[key]; const li = document.createElement('li'); li.className = 'list-group-item d-flex justify-content-between align-items-center'; li.innerHTML = `<span>${c.name}</span><div><button class="btn btn-sm btn-info me-2" onclick="editCategory('${key}')"><i class="bi bi-pencil-square"></i></button><button class="btn btn-sm btn-danger" onclick="deleteCategory('${key}')"><i class="bi bi-trash"></i></button></div>`; catList.appendChild(li); const opt = document.createElement('option'); opt.value = c.name; opt.textContent = c.name; prodCatSelect.appendChild(opt); } }); };
        const loadProductsForAdmin = () => { database.ref('products').on('value', snapshot => { allAdminProducts = snapshot.val() || {}; const tableBody = document.getElementById('existing-products-table'); tableBody.innerHTML = ''; const productKeys = Object.keys(allAdminProducts).reverse(); for (const key of productKeys) { const p = allAdminProducts[key]; tableBody.innerHTML += `<tr><td>${p.name}</td><td>${p.category}</td><td class="text-end"><button class="btn btn-sm btn-info me-2" onclick="editProduct('${key}')"><i class="bi bi-pencil-square"></i></button><button class="btn btn-sm btn-danger" onclick="deleteProduct('${key}')"><i class="bi bi-trash"></i></button></td></tr>`; } }); };
        
        auth.onAuthStateChanged(user => { if (user) { loginSection.style.display = 'none'; adminPanelSection.style.display = 'block'; loadCategories(); loadProductsForAdmin(); loadSocialLinks(); loadBannerData(); } else { loginSection.style.display = 'flex'; adminPanelSection.style.display = 'none'; } });
        loginForm.addEventListener('submit', (e) => { e.preventDefault(); const email = document.getElementById('email').value, password = document.getElementById('password').value; loginError.textContent = ''; auth.signInWithEmailAndPassword(email, password).catch(err => loginError.textContent = err.message); });
        logoutButton.addEventListener('click', () => auth.signOut());
        
        document.getElementById('socialLinksForm').addEventListener('submit', (e) => { e.preventDefault(); const linksData = { facebook: document.getElementById('facebookLink').value, instagram: document.getElementById('instagramLink').value, telegram: document.getElementById('telegramLink').value }; database.ref('socialLinks').set(linksData).then(() => alert('Social links saved!')).catch(err => alert(err.message)); });
        document.getElementById('bannerForm').addEventListener('submit', (e) => { e.preventDefault(); const bannerData = { imageUrl: document.getElementById('bannerImageUrl').value, affiliateLink: document.getElementById('bannerAffiliateLink').value, title: document.getElementById('bannerTitle').value }; database.ref('mainBanner').set(bannerData).then(() => alert('Banner updated successfully!')).catch(err => alert(err.message)); });
        
        window.editCategory = (key) => { const cat = allAdminCategories[key]; document.getElementById('editCategoryKey').value = key; document.getElementById('category_name').value = cat.name; document.getElementById('category-form-title').innerText = 'Edit Category'; document.getElementById('category-submit-btn').innerText = 'Update Category'; document.getElementById('category-cancel-edit-btn').classList.remove('d-none'); };
        window.deleteCategory = (key) => { const cat = allAdminCategories[key]; if (confirm(`Are you sure you want to delete the category "${cat.name}"? This will NOT delete products in it.`)) { database.ref('categories/' + key).remove().then(() => alert('Category deleted!')).catch(err => alert(err.message)); } };
        document.getElementById('category-cancel-edit-btn').addEventListener('click', () => { document.getElementById('categoryForm').reset(); document.getElementById('editCategoryKey').value = ''; document.getElementById('category-form-title').innerText = 'Add Category'; document.getElementById('category-submit-btn').innerText = 'Add Category'; document.getElementById('category-cancel-edit-btn').classList.add('d-none'); });
        document.getElementById('categoryForm').addEventListener('submit', (e) => { e.preventDefault(); const newName = document.getElementById('category_name').value; const editKey = document.getElementById('editCategoryKey').value; if (editKey) { const oldName = allAdminCategories[editKey].name; const updates = {}; updates['/categories/' + editKey + '/name'] = newName; for (const productKey in allAdminProducts) { if (allAdminProducts[productKey].category === oldName) { updates['/products/' + productKey + '/category'] = newName; } } database.ref().update(updates).then(() => { alert('Category and related products updated!'); document.getElementById('category-cancel-edit-btn').click(); }).catch(err => alert(err.message)); } else { database.ref('categories').push({ name: newName }).then(() => e.target.reset()).catch(err => alert(err.message)); } });
        
        window.editProduct = (key) => { const p = allAdminProducts[key]; document.getElementById('editProductKey').value = key; document.getElementById('product_name').value = p.name; document.getElementById('product_mrp').value = p.mrp; document.getElementById('product_price').value = p.price; document.getElementById('product_category').value = p.category; document.getElementById('product_description').value = p.description; document.getElementById('affiliate_link').value = p.link; document.getElementById('image_url').value = p.imageUrl; document.getElementById('product-form-title').innerText = "Edit Product"; document.getElementById('product-submit-btn').innerText = "Update Product"; document.getElementById('product-cancel-edit-btn').classList.remove('d-none'); window.scrollTo({ top: 0, behavior: 'smooth' }); };
        window.deleteProduct = (key) => { if (confirm(`Are you sure you want to delete "${allAdminProducts[key].name}"?`)) { database.ref('products/' + key).remove().then(() => alert('Product deleted!')).catch(err => alert(err.message)); } };
        document.getElementById('product-cancel-edit-btn').addEventListener('click', () => { document.getElementById('productForm').reset(); document.getElementById('editProductKey').value = ''; document.getElementById('product-form-title').innerText = "Add New Product"; document.getElementById('product-submit-btn').innerText = "Add Product"; document.getElementById('product-cancel-edit-btn').classList.add('d-none'); });
        document.getElementById('productForm').addEventListener('submit', (e) => { e.preventDefault(); const productData = { name: document.getElementById('product_name').value, description: document.getElementById('product_description').value, link: document.getElementById('affiliate_link').value, imageUrl: document.getElementById('image_url').value, category: document.getElementById('product_category').value, mrp: parseFloat(document.getElementById('product_mrp').value), price: parseFloat(document.getElementById('product_price').value) }; const editKey = document.getElementById('editProductKey').value; if (editKey) { database.ref('products/' + editKey).update(productData).then(() => { alert('Product Updated!'); document.getElementById('product-cancel-edit-btn').click(); }).catch(err => alert(err.message)); } else { database.ref('products').push(productData).then(() => { alert('Product Added!'); e.target.reset(); }).catch(err => alert(err.message)); } });
    </script>
</body>
</html>